%% Test model system variable consistency across commands
\set[_echo_command="true"]

%% Create multiple models
\model-new[catalog_id="O4M"] first-model
\model-new[catalog_id="O3"] second-model
\model-new[provider="openai", base_model="gpt-3.5-turbo", description="Third model"] third-model

%% Check initial count
\get[#model_count]

%% Activate first model and check all variables
\model-activate first-model
\get[#active_model_name]
\get[#active_model_id]
\get[#active_model_provider]
\get[#active_model_base]

%% Switch active model and verify variables update
\model-activate second-model
\get[#active_model_name]
\get[#active_model_provider]
\get[#active_model_base]

%% Check status and count variables remain consistent
\model-status
\get[#model_count]
\get[#model_filtered_count]

%% Delete a model and verify counts update
\model-delete third-model
\get[#model_count]
\get[#deleted_model_name]

%% Verify active model remains unchanged after deletion
\get[#active_model_name]

%% Delete active model and verify variables are cleared  
\model-delete second-model
\get[#active_model_name]
\get[#active_model_id]
\get[#model_count]

%% Activate remaining model
\model-activate first-model
\get[#active_model_name]

%% Final consistency check
\model-status
\get[#model_count]
\get[#model_filtered_count]