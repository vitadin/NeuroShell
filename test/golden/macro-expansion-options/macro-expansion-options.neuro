%% Macro expansion with command options test
\set[_echo_commands="true"]

%% Test 1: Command with single option expansion
\set[silent_echo="\echo[silent=true]"]
${silent_echo} This should be silent
\get[_output]

%% Test 2: Command with multiple options expansion
\set[raw_to_var="\echo[raw=true,to=raw_var]"]
${raw_to_var} Raw\nContent\tHere
\get[raw_var]

%% Test 3: Command with interpolated option values
\set[output_var="my_result"]
\set[echo_to_var="\echo[to=${output_var}]"]
${echo_to_var} Stored in dynamic variable
\get[my_result]

%% Test 4: Set command expansion with interpolated values
\set[var_name="test_var"]
\set[var_value="Macro Set"]
\set[set_command="\set[${var_name}=${var_value}]"]
${set_command}
\get[test_var]

%% Test 5: Complex option combinations
\set[style_color="blue"]
\set[target_variable="styled_content"]
\set[styled_echo="\echo[style=${style_color},raw=false,to=${target_variable}]"]
${styled_echo} This is\nStyled\tContent
\get[styled_content]

%% Test 6: Boolean option expansion
\set[raw_mode="true"]
\set[silent_mode="false"]
\set[configurable_echo="\echo[raw=${raw_mode},silent=${silent_mode}]"]
${configurable_echo} Configurable\nOutput
\get[_output]

%% Test 7: Command with interpolated style option
\set[color="green"]
\set[dest="option_test"]
\set[styled_cmd="\echo[style=${color},to=${dest}]"]
${styled_cmd} Just testing options
\get[option_test]

%% Test 8: Mixed static and dynamic options
\set[dynamic_target="final_result"]
\set[mixed_cmd="\echo[raw=true,to=${dynamic_target},style=cyan]"]
${mixed_cmd} Mixed\nOptions\tTest
\get[final_result]