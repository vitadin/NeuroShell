# NeuroShell Release Process

## Overview

NeuroShell uses a fully automated release pipeline powered by GitHub Actions and GoReleaser v2. The release process is designed to be simple, consistent, and maintainable while preserving the integrity of our embedded changelog system.

## Release Workflow

### 1. Pre-Release Preparation

#### Update Changelog
Before creating a release, ensure the changelog is updated:

1. Edit `internal/data/embedded/change-logs/change-logs.yaml`
2. Add a new entry following the established format (see `docs/CHANGELOG_TEMPLATE.md`)
3. Assign the next changelog ID (e.g., `CL3`, `CL4`, etc.)
4. Include the target version, date, type, title, description, impact, and files changed

#### Update Base Version
1. Check the current base version in `scripts/version.sh` (line 8)
2. Update `BASE_VERSION` to match your intended release version
3. Ensure the version follows semantic versioning (e.g., `0.3.0`, `0.2.3`)

### 2. Creating a Release

#### Tag Creation
Release are triggered by creating and pushing semantic version tags:

```bash
# Create and push a release tag
git tag v0.3.0
git push origin v0.3.0
```

**Tag Format Requirements:**
- Must start with `v` (e.g., `v0.3.0`, `v1.0.0`)
- Must follow semantic versioning
- Should match the base version in `scripts/version.sh`
- Should match the version in the latest changelog entry

#### Automatic Process
Once the tag is pushed, GitHub Actions will automatically:

1. **Validate** the tag format and version
2. **Build** cross-platform binaries for:
   - Linux (amd64, arm64)
   - macOS (amd64, arm64) 
   - Windows (amd64, arm64)
3. **Inject** version information using the existing ldflags pattern
4. **Extract** changelog information for the release
5. **Create** a GitHub release with:
   - Codename in the title (e.g., "NeuroShell v0.3.0 'Aplysia'")
   - Changelog description
   - Binary attachments
   - Checksums file

### 3. Release Artifacts

Each release includes:
- **Cross-platform binaries** for all supported platforms
- **Archives** (tar.gz for Unix, zip for Windows)
- **Checksums** file for verification
- **Source code** archive (automatic)

### 4. Version and Codename System

NeuroShell uses a sophisticated version system with animal codenames representing neural complexity:

- `0.1.0` = "Hydra" (Simple nerve net)
- `0.2.0` = "Planaria" (Simple brain, basic learning)
- `0.3.0` = "Aplysia" (Sea slug, neuroscience research)
- `0.4.0` = "Octopus" (Highly intelligent invertebrate)
- `0.5.0` = "Corvus" (Crow, exceptional bird intelligence)
- `0.6.0` = "Rattus" (Rat, standard neuroscience model)
- `0.7.0` = "Macaca" (Macaque, advanced primate cognition)
- `0.8.0` = "Pan" (Chimpanzee, tool use, social intelligence)
- `0.9.0` = "Tursiops" (Dolphin, self-awareness, communication)
- `1.0.0` = "Sapiens" (Human-level intelligence milestone)
- `2.0.0` = "Synthia" (Synthetic intelligence beyond biological)

The codename is automatically included in release titles and descriptions.

## Changelog Consistency

### Single Source of Truth
The `internal/data/embedded/change-logs/change-logs.yaml` file serves as the authoritative source for all changelog information. This ensures consistency between:

- The `\change-log-show` command in the CLI
- GitHub release descriptions
- Historical release notes

### Entry Format
Each changelog entry includes:
- **ID**: Unique identifier (CL1, CL2, CL3, etc.)
- **Version**: Semantic version string
- **Date**: Release date in YYYY-MM-DD format
- **Type**: Entry type (feature, bugfix, enhancement, etc.)
- **Title**: Brief summary of the release
- **Description**: Detailed description of changes
- **Impact**: User-facing impact description
- **Files Changed**: List of modified files/directories

## Development vs Release Builds

### Development Builds
- Generated by `just build` or `scripts/version.sh`
- Include commit count and hash (e.g., `0.2.2+45.abc1234`)
- Used for testing and development

### Release Builds  
- Generated by GoReleaser on tag push
- Clean semantic version (e.g., `0.3.0`)
- Include proper build metadata
- Signed and checksummed

## Troubleshooting

### Common Issues

#### Tag Already Exists
If you need to recreate a tag:
```bash
# Delete local and remote tag
git tag -d v0.3.0
git push origin :refs/tags/v0.3.0

# Recreate and push
git tag v0.3.0
git push origin v0.3.0
```

#### Build Failures
Check the GitHub Actions logs for specific errors:
1. Go to the Actions tab in the GitHub repository
2. Find the failed release workflow
3. Review build logs for each platform

#### Version Mismatch
Ensure consistency between:
- Tag version (e.g., `v0.3.0`)
- `scripts/version.sh` BASE_VERSION (e.g., `0.3.0`)
- Latest changelog entry version

## Integration with CI/CD

The release pipeline is designed to complement, not replace, the existing CircleCI testing infrastructure:

- **CircleCI**: Handles comprehensive testing, linting, and validation
- **GitHub Actions**: Focuses solely on building and releasing
- **No Overlap**: Release pipeline skips redundant testing

This separation ensures fast releases while maintaining code quality through the established CI process.

## Security Considerations

- **Token Permissions**: GitHub Actions use minimal required permissions
- **Binary Signing**: Checksums provided for artifact verification
- **Dependency Management**: GoReleaser and actions pinned to specific versions
- **Secrets**: No sensitive information exposed in workflows

## Future Enhancements

Planned improvements to the release process:
- Homebrew formula automation
- Docker image builds
- Debian/RPM package generation
- Release announcement automation